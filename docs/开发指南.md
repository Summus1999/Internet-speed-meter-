# å¼€å‘æŒ‡å—

## å¼€å‘å…¥é—¨

### å‰ç½®æ¡ä»¶

- Rust 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
  - å®‰è£…: https://rustup.rs/
  - éªŒè¯: `rustc --version` å’Œ `cargo --version`
- Git ç‰ˆæœ¬æ§åˆ¶
- æ–‡æœ¬ç¼–è¾‘å™¨æˆ– IDEï¼ˆæ¨è VS Code é…åˆ Rust Analyzerï¼‰

### åˆå§‹è®¾ç½®

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd Internet-speed-meter-

# å®‰è£…ä¾èµ–
cargo build

# è¿è¡Œæµ‹è¯•
cargo test

# æ„å»ºå‘å¸ƒç‰ˆæœ¬
cargo build --release
```

---

## é¡¹ç›®æ¶æ„

### ç›®å½•å¸ƒå±€

```
src/
â”œâ”€â”€ main.rs              # CLI å…¥å£ï¼Œå‘½ä»¤è§£æ
â”œâ”€â”€ speed_test.rs        # é€Ÿåº¦æµ‹è¯•æ¨¡å—
â”œâ”€â”€ diagnostics.rs       # ç½‘ç»œè¯Šæ–­æ¨¡å—
â””â”€â”€ utils.rs             # å·¥å…·å‡½æ•°

docs/
â”œâ”€â”€ APIæ–‡æ¡£.md           # API æ–‡æ¡£
â”œâ”€â”€ å¼€å‘æŒ‡å—.md          # å¼€å‘æŒ‡å—
â”œâ”€â”€ ç”¨æˆ·æŒ‡å—.md          # ç”¨æˆ·æ‰‹å†Œ
â””â”€â”€ æ•…éšœæ’é™¤.md          # æ•…éšœæ’é™¤æŒ‡å—

Cargo.toml              # é¡¹ç›®é…ç½®å’Œä¾èµ–
Cargo.lock              # é”å®šçš„ç‰ˆæœ¬
```

### æ¨¡å—ä¾èµ–å…³ç³»

```
main.rs
â”œâ”€â”€ ä¾èµ–: speed_test.rs
â”œâ”€â”€ ä¾èµ–: diagnostics.rs
â”œâ”€â”€ ä¾èµ–: utils.rs
â”‚
speed_test.rs
â”œâ”€â”€ ä¾èµ–: æ— å†…éƒ¨æ¨¡å—
â”œâ”€â”€ å¤–éƒ¨: anyhow, serde, tokio
â”‚
diagnostics.rs
â”œâ”€â”€ ä¾èµ–: æ— å†…éƒ¨æ¨¡å—
â”œâ”€â”€ å¤–éƒ¨: anyhow, serde, tokio
â”‚
utils.rs
â”œâ”€â”€ ä¾èµ–: æ— å†…éƒ¨æ¨¡å—
â”œâ”€â”€ å¤–éƒ¨: chrono
```

---

## ä»£ç é£æ ¼å’Œçº¦å®š

### å‘½åçº¦å®š

- **æ¨¡å—å’Œæ–‡ä»¶**: snake_caseï¼ˆ`speed_test.rs`ï¼‰
- **ç±»å‹å’Œç»“æ„ä½“**: PascalCaseï¼ˆ`SpeedTester`ã€`DiagnosticResult`ï¼‰
- **å‡½æ•°å’Œå˜é‡**: snake_caseï¼ˆ`run_speed_test()`ã€`target_host`ï¼‰
- **å¸¸é‡**: UPPER_SNAKE_CASEï¼ˆ`DEFAULT_TIMEOUT`ï¼‰

### ä»£ç ç»„ç»‡

1. **é¡¶éƒ¨å¯¼å…¥**
   ```rust
   use std::time::Instant;
   use anyhow::Result;
   ```

2. **å…¬å¼€é¡¹ç›®åœ¨å‰**
   ```rust
   pub struct MyStruct { }
   impl MyStruct {
       pub fn public_method() { }
       fn private_method() { }
   }
   ```

3. **å¤æ‚é€»è¾‘æ·»åŠ æ³¨é‡Š**
   ```rust
   // æ£€æŸ¥è¿é€šæ€§
   let connectivity = self.check_connectivity(target_host).await?;
   ```

### é”™è¯¯å¤„ç†

å¯¹äºå¯èƒ½å¤±è´¥çš„æ“ä½œï¼Œå§‹ç»ˆä½¿ç”¨ `Result<T>`ï¼š

```rust
// å¥½çš„åšæ³•
pub async fn run_test(&self) -> Result<SpeedTestResult> {
    // ...
    Ok(result)
}

// ä¸å¥½çš„åšæ³• - ä¸è¦åœ¨åº“ä»£ç ä¸­ unwrap
pub fn get_value() -> Value {
    something.unwrap() // é¿å…ï¼
}
```

---

## æ„å»ºå’Œæµ‹è¯•

### æ„å»ºå‘½ä»¤

```bash
# è°ƒè¯•æ„å»º
cargo build

# å‘å¸ƒæ„å»ºï¼ˆä¼˜åŒ–ï¼‰
cargo build --release

# æ¸…é™¤æ„å»ºäº§ç‰©
cargo clean

# æ£€æŸ¥ï¼ˆä¸æ„å»ºï¼‰
cargo check
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_name

# è¿è¡Œæµ‹è¯•æ—¶æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture

# ä»¥å‘å¸ƒæ¨¡å¼è¿è¡Œæµ‹è¯•
cargo test --release
```

### ä»£ç è´¨é‡

```bash
# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# æ£€æŸ¥ä»£ç é£æ ¼
cargo clippy

# ç”Ÿæˆæ–‡æ¡£
cargo doc --open

# æ£€æŸ¥ç¼–è¯‘å™¨è­¦å‘Š
cargo check --all-targets
```

---

## æ·»åŠ æ–°åŠŸèƒ½

### åˆ›å»ºæ–°æ¨¡å—

1. **åˆ›å»ºæ¨¡å—æ–‡ä»¶**ï¼ˆä¾‹å¦‚ `src/my_feature.rs`ï¼‰

```rust
// src/my_feature.rs
use anyhow::Result;

pub struct MyFeature;

impl MyFeature {
    pub fn new() -> Self {
        MyFeature
    }
    
    pub async fn do_something(&self) -> Result<()> {
        // å®ç°
        Ok(())
    }
}
```

2. **åœ¨ main.rs ä¸­æ·»åŠ æ¨¡å—**

```rust
// åœ¨ src/main.rs ä¸­
mod my_feature;
use my_feature::MyFeature;
```

3. **å¦‚æœéœ€è¦ï¼Œæ›´æ–° CLI**ï¼ˆåœ¨ src/main.rs ä¸­ï¼‰

```rust
#[derive(Parser, Debug)]
enum Commands {
    // ... ç°æœ‰å‘½ä»¤
    MyCommand {
        #[arg(short, long)]
        option: String,
    },
}
```

4. **æ·»åŠ å¤„ç†å‡½æ•°**

```rust
async fn handle_my_command(option: String) -> Result<()> {
    let feature = MyFeature::new();
    feature.do_something().await?;
    Ok(())
}
```

### æ·»åŠ ä¾èµ–

1. **ç¼–è¾‘ Cargo.toml**

```toml
[dependencies]
new_crate = \"1.0\"
```

2. **æ›´æ–° Cargo.lock**

```bash
cargo update
```

3. **åœ¨ä»£ç ä¸­å¯¼å…¥**

```rust
use new_crate::something;
```

---

## å¸¸è§ä»»åŠ¡

### æ·»åŠ æ–°çš„è¯Šæ–­æ£€æŸ¥

```rust
// åœ¨ src/diagnostics.rs ä¸­
impl NetworkDiagnostics {
    async fn check_firewall(&self, target_host: &str) -> Result<bool> {
        // å®ç°
        Ok(true)
    }
    
    pub async fn run_full_diagnostic(&self, target_host: &str) -> Result<DiagnosticResult> {
        // ... ç°æœ‰ä»£ç 
        let firewall_ok = self.check_firewall(target_host).await?;
        // ... å…¶ä½™å®ç°
    }
}
```

### æ·»åŠ æ–°çš„é€Ÿåº¦æµ‹è¯•æŒ‡æ ‡

```rust
// åœ¨ src/speed_test.rs ä¸­
pub struct SpeedTestResult {
    pub download_speed: f64,
    pub upload_speed: f64,
    pub ping: f64,
    pub new_metric: f64,  // æ·»åŠ åœ¨è¿™é‡Œ
    pub test_duration: f64,
}

impl SpeedTestResult {
    pub fn print_summary(&self) {
        // ... ç°æœ‰è¾“å‡º
        println!(\"ğŸ“Š æ–°æŒ‡æ ‡: {:.2}\", self.new_metric);
    }
}
```

### æ ¼å¼åŒ–è¾“å‡º

éµå¾ªç°æœ‰çš„ emoji å’Œæ–¹æ¡†ç»˜åˆ¶æ¨¡å¼ï¼š

```rust
println!(\"ğŸ“Š çŠ¶æ€æŠ¥å‘Š\");
println!(\"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\");
println!(\"âœ“ é¡¹ç›® 1: {}\", value1);
println!(\"âš ï¸  é¡¹ç›® 2: {}\", value2);
println!(\"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\");
```

---

## è°ƒè¯•

### æ—¥å¿—å’Œè°ƒè¯•è¾“å‡º

```bash
# è¿è¡Œè°ƒè¯•è¾“å‡º
RUST_LOG=debug cargo run

# è¿è¡Œæ—¶å¸¦å›æº¯
RUST_BACKTRACE=1 cargo run
```

### å¸¸è§é—®é¢˜

**é—®é¢˜ï¼š\"æ— æ³•åœ¨æ­¤ä½œç”¨åŸŸä¸­æ‰¾åˆ°ç»“æ„ä½“/å‡½æ•°\"**
- è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ¨¡å—æ˜¯å¦åœ¨ main.rs ä¸­å£°æ˜å’Œå¯¼å…¥

**é—®é¢˜ï¼š\"ç±»å‹ä¸åŒ¹é…\"**
- è§£å†³æ–¹æ¡ˆï¼šéªŒè¯ç±»å‹åŒ¹é…ï¼Œç‰¹åˆ«æ˜¯ `Result<T>` vs `T`

**é—®é¢˜ï¼š\"future æœªå®ç° Send\"**
- è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æ‰€æœ‰ future åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­å®ç° Send trait

---

## æ€§èƒ½è€ƒè™‘

### å¼‚æ­¥æœ€ä½³å®è·µ

1. **ä¸è¦é˜»æ­¢å¼‚æ­¥ä»£ç **
   ```rust
   // ä¸å¥½çš„åšæ³•
   async fn bad() {
       std::thread::sleep(Duration::from_secs(1));  // é˜»æ­¢æ‰§è¡Œå™¨ï¼
   }
   
   // å¥½çš„åšæ³•
   async fn good() {
       tokio::time::sleep(Duration::from_secs(1)).await;
   }
   ```

2. **å¯¹å¼‚æ­¥æ“ä½œä½¿ç”¨ Tokio**
   ```rust
   let delay = tokio::time::sleep(Duration::from_secs(1));
   ```

3. **é¿å…ä¸å¿…è¦çš„åˆ†é…**
   ```rust
   // å¥½çš„
   let items: Vec<_> = list.iter().map(|x| x * 2).collect();
   
   // è€ƒè™‘æ˜¯å¦éœ€è¦
   let items: Vec<_> = large_list.iter().take(10).map(|x| x * 2).collect();
   ```

---

## æ–‡æ¡£

### ä»£ç æ–‡æ¡£æ³¨é‡Š

```rust
/// ç®€è¦æè¿°
/// 
/// # å‚æ•°
/// * `param1` - param1 çš„æè¿°
/// * `param2` - param2 çš„æè¿°
/// 
/// # è¿”å›
/// è¿”å›å€¼çš„æè¿°
/// 
/// # ç¤ºä¾‹
/// ```rust
/// let result = my_function(1, 2)?;
/// ```
/// 
/// # é”™è¯¯
/// å¦‚æœå‘ç”Ÿ X è¿”å›é”™è¯¯
pub async fn my_function(param1: u32, param2: &str) -> Result<String> {
    // å®ç°
}
```

### ç”Ÿæˆæ–‡æ¡£

```bash
# ç”Ÿæˆå¹¶æ‰“å¼€æ–‡æ¡£
cargo doc --open

# ä¸ºä¾èµ–é¡¹ç”Ÿæˆæ–‡æ¡£
cargo doc --open --no-deps=false
```

---

## ç‰ˆæœ¬ç®¡ç†

### è¯­ä¹‰åŒ–ç‰ˆæœ¬

å½“å‰ç‰ˆæœ¬ï¼š**0.1.0**ï¼ˆMAJOR.MINOR.PATCHï¼‰

- **MAJOR**: ç ´åæ€§å˜æ›´
- **MINOR**: æ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- **PATCH**: é”™è¯¯ä¿®å¤

### æ›´æ–°ç‰ˆæœ¬

ç¼–è¾‘ `Cargo.toml`ï¼š
```toml
[package]
version = \"0.2.0\"
```

---

## å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡: `cargo test`
- [ ] ä»£ç æ ¼å¼åŒ–: `cargo fmt`
- [ ] æ—  clippy è­¦å‘Š: `cargo clippy`
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] CHANGELOG.md å·²æ›´æ–°
- [ ] Cargo.toml ä¸­ç‰ˆæœ¬å·²æ›´æ–°
- [ ] Git æäº¤å·²ç»„ç»‡
- [ ] æ„å»ºæˆåŠŸ: `cargo build --release`

---

## æœ‰ç”¨çš„èµ„æº

- **Rust ä¹¦ç±**: https://doc.rust-lang.org/book/
- **Tokio æ–‡æ¡£**: https://tokio.rs/
- **Clap æ–‡æ¡£**: https://docs.rs/clap/
- **Rust ç¤ºä¾‹**: https://doc.rust-lang.org/rust-by-example/
- **å¸¸è§é›†åˆ**: https://doc.rust-lang.org/book/ch08-00-common-collections.html

---

## è´¡çŒ®æŒ‡å—

1. **Fork å¹¶å…‹éš†**ä»“åº“
2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**: `git checkout -b feature/my-feature`
3. **è¿›è¡Œæ›´æ”¹**å¹¶éµå¾ªä»£ç é£æ ¼
4. **ä¸ºæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•**
5. **è¿è¡Œæµ‹è¯•**: `cargo test`
6. **æ ¼å¼åŒ–ä»£ç **: `cargo fmt`
7. **æ£€æŸ¥è­¦å‘Š**: `cargo clippy`
8. **æäº¤å¹¶æ˜ç¡®æäº¤ä¿¡æ¯**: `git commit -m \"æ·»åŠ åŠŸèƒ½ X\"`
9. **æ¨é€å¹¶åˆ›å»º pull request**

---

## æ•…éšœæ’é™¤

### æ„å»ºé—®é¢˜

**é—®é¢˜ï¼š\"é”™è¯¯ï¼šæ— æ³•ç¼–è¯‘\"**

è§£å†³æ­¥éª¤ï¼š
1. æ¸…é™¤: `cargo clean`
2. æ›´æ–°: `cargo update`
3. æ£€æŸ¥ Rust ç‰ˆæœ¬: `rustc --version`
4. é‡æ–°æ„å»º: `cargo build`

### è¿è¡Œæ—¶é—®é¢˜

**é—®é¢˜ï¼šåº”ç”¨ç¨‹åºå´©æºƒå¹¶å¸¦æœ‰ panic

è§£å†³æ–¹æ¡ˆï¼š
1. ä½¿ç”¨å›æº¯è¿è¡Œ: `RUST_BACKTRACE=1 cargo run`
2. æ£€æŸ¥é”™è¯¯æ¶ˆæ¯
3. æŸ¥çœ‹æœ€è¿‘çš„æ›´æ”¹
4. åˆ›å»ºé—®é¢˜å¹¶é™„ä¸Šé‡ç°æ­¥éª¤

---

æœ€åæ›´æ–°: 2025 å¹´ 11 æœˆ 16 æ—¥

æœ‰ä»»ä½•é—®é¢˜æˆ–è´¡çŒ®ï¼Œè¯·åœ¨ä»“åº“ä¸Šæ‰“å¼€ issueã€‚
